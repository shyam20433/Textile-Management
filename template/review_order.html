<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Your Order</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .dress-image {
            max-width: 300px;
            height: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        body {
            background-color: #0c0c0c;
            color: #f0f0f0;
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
        }
        .container {
            margin-top: 50px;
        }
        .summary {
            background-color: #1a1a1a;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .summary h2 {
            color: #39ff14;
            margin-bottom: 20px;
        }
        .summary p {
            font-size: 18px;
            margin: 10px 0;
        }
        .summary .total-price {
            font-weight: bold;
            color: #39ff14;
            font-size: 22px;
        }
        .edit-button {
            margin-left: 10px;
            cursor: pointer;
            color: #39ff14;
            transition: color 0.3s;
        }
        .edit-button:hover {
            color: #32c93a;
            text-decoration: underline;
        }
        .edit-form {
            display: none; /* Initially hidden */
            margin-top: 20px;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .edit-form h3 {
            color: #39ff14;
            margin-bottom: 15px;
        }
        .edit-form label {
            font-weight: bold;
            margin-top: 10px;
        }
        .edit-form select {
            margin-bottom: 15px;
            width: 100%;
            padding: 10px;
            border: 1px solid #39ff14;
            border-radius: 5px;
            background-color: #1c1c1c;
            color: #f0f0f0;
            transition: border-color 0.3s;
        }
        .btn-primary, .btn-secondary {
            margin-top: 10px;
        }
        .btn-primary {
            background-color: #39ff14;
            border: none;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #32c93a;
        }
        .btn-secondary {
            background-color: #555;
            border: none;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="summary row">
            <div class="col-md-6">
                <h2>Review Your Order</h2>
                <p><strong>Dress Name:</strong> {{ dress.name }}</p>
                <p><strong>Description:</strong> {{ dress.description }}</p>
                <p><strong>Color:</strong> {{ dress.color }}</p>
                <p><strong>Gender:</strong> {{ gender }}</p>

                <div>
                    <strong>Dress Type:</strong>
                    <span id="dress-type-display">{{ dress_type }}</span>
                    <span class="edit-button" onclick="editOption()">Edit</span>
                </div>

                <div>
                    <strong>Dress Design:</strong>
                    <span id="dress-design-display">{{ dress_design }}</span>
                    <span class="edit-button" onclick="editOption()">Edit</span>
                </div>

                <div>
                    <strong>Size:</strong>
                    <span id="size-display">{{ size }}</span>
                    <span class="edit-button" onclick="editOption()">Edit</span>
                </div>

                <div>
                    <strong>Quantity:</strong>
                    <span id="quantity-display">{{ quantity }}</span>
                    <span class="edit-button" onclick="editOption()">Edit</span>
                </div>

                <p class="total-price"><strong>Total Price:</strong> â‚¹<span id="total-price">{{ total_price }}</span></p>

                <div class="col-md-6">
                    <form method="POST" action="{{ url_for('place_order', dress_id=dress._id) }}">
                        <input type="hidden" id="hidden-dress-type" name="dress_type" value="{{ dress_type }}">
                        <input type="hidden" id="hidden-dress-design" name="dress_design" value="{{ dress_design }}">
                        <input type="hidden" id="hidden-size" name="size" value="{{ size }}">
                        <input type="hidden" id="hidden-quantity" name="quantity" value="{{ quantity }}">
                        <input type="hidden" name="gender" value="{{ gender }}">
                        <input type="hidden" name="color" value="{{ dress.color }}">
                        <button type="submit" class="btn btn-success">Confirm Order</button>
                    </form>
                </div>

                <!-- Edit Form -->
                <div class="edit-form" id="edit-form">
                    <h3>Edit Order</h3>
                    <label for="edit-dress-type">Dress Type:</label>
                    <select id="edit-dress-type" name="edit_dress_type" onchange="updateDesignOptions(); updateTotalPrice();">
                        <option value="">Select Dress Type</option>
                    </select>

                    <label for="edit-dress-design">Dress Design:</label>
                    <select id="edit-dress-design" name="edit_dress_design" onchange="updateTotalPrice();">
                        <option value="">Select Dress Design</option>
                    </select>

                    <label for="edit-size">Size:</label>
                    <select id="edit-size" name="edit_size" onchange="updateTotalPrice();">
                        <option value="">Select Size</option>
                    </select>

                    <label for="edit-quantity">Quantity:</label>
                    <select id="edit-quantity" name="edit_quantity" onchange="updateTotalPrice();">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>

                    <button class="btn btn-primary" onclick="saveChanges()">Save Changes</button>
                    <button class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
                </div>
            </div>
            <div class="col-md-6 text-center">
                {% if image_url %}
                    <img src="{{ image_url }}" alt="Dress Image" class="dress-image">
                {% else %}
                    <p>No image available for the selected dress customization.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        const dressData = {
            baby: {
                'Footed romper': {
                    designs: ['Full Hand', 'Half Hand', 'Sleeveless', 'Shorts'],
                    sizes: { 'small': { price: (0.60 * {{ dress.price }}) }, 'medium': { price: (0.75 * {{ dress.price }}) }, 'large': { price: (1.00 * {{ dress.price }}) } }
                },
                'Snap-up romper': {
                    designs: ['Full Hand', 'Half Hand', 'Sleeveless', 'Shorts'],
                    sizes: { 'small': { price: (0.60 * {{ dress.price }}) }, 'medium': { price: (0.75 * {{ dress.price }}) }, 'large': { price: (1.00 * {{ dress.price }}) } }
                },
                'Hoody': {
                    designs: ['Hooded onesie','Baby sweat suit', 'Cotton jumpsuit'],
                    sizes: { 'small': { price: (0.60 * {{ dress.price }}) }, 'medium': { price: (0.75 * {{ dress.price }}) }, 'large': { price: (1.00 * {{ dress.price }}) } }
                },
            },
            men: {
                'Pant': {
                    designs: ['Chinos', 'Jeans', 'Shorts', 'Cargo'],
                    sizes: { '28': { price: (1.00 * {{ dress.price }}) }, '30': { price: (1.00 * {{ dress.price }}) }, '32': { price: (1.00 * {{ dress.price }}) }, '34': { price: (1.00 * {{ dress.price }}) }, '36': { price: (1.00 * {{ dress.price }}) }, '38': { price: (1.00 * {{ dress.price }}) } }
                },
                'Shirt': {
                    designs: ['Full Hand', 'Casual', 'Half Hand', 'T-Shirt'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
                'Jacket': {
                    designs: ['Leather', 'Denim', 'Long sleeve'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
                'Sweater': {
                    designs: ['Pullover', 'Cardigan', 'Crew Neck', 'V-Neck'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
                'sweater': {
                    designs: ['Casual', 'Formal'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
            },
            women: {
                'Top': {
                    designs: ['T-Shirt', 'Blouse', 'Tank Top', 'Hoodie'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
                'Skirt': {
                    designs: ['A-Line', 'Pencil', 'Maxi', 'Mini'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
                'Legging': {
                    designs: ['Full Length', 'Capri', 'High Waist', 'Printed'],
                    sizes: { '28': { price: (1.00 * {{ dress.price }}) }, '30': { price: (1.00 * {{ dress.price }}) }, '32': { price: (1.00 * {{ dress.price }}) }, '34': { price: (1.00 * {{ dress.price }}) }, '36': { price: (1.00 * {{ dress.price }}) }, '38': { price: (1.00 * {{ dress.price }}) } }
                },
                'Pant': {
                    designs: ['Straight', 'Skinny', 'Wide Leg', 'Culottes'],
                    sizes: { '28': { price: (1.00 * {{ dress.price }}) }, '30': { price: (1.00 * {{ dress.price }}) }, '32': { price: (1.00 * {{ dress.price }}) }, '34': { price: (1.00 * {{ dress.price }}) }, '36': { price: (1.00 * {{ dress.price }}) }, '38': { price: (1.00 * {{ dress.price }}) } }
                },
                'Jacket': {
                    designs: ['Long sleeve', 'Short Sleeve',  'Open Front'],
                    sizes: { 'S': { price: (1.00 * {{ dress.price }}) }, 'M': { price: (1.00 * {{ dress.price }}) }, 'L': { price: (1.00 * {{ dress.price }}) }, 'XL': { price: (1.00 * {{ dress.price }}) } }
                },
            }
        };

        function editOption() {
            const editForm = document.getElementById('edit-form');
            editForm.style.display = editForm.style.display === 'block' ? 'none' : 'block';
            if (editForm.style.display === 'block') {
                populateEditForm();
            }
        }

        function populateEditForm() {
            const gender = '{{ gender }}';
            const dressType = '{{ dress_type }}';
            const dressDesign = '{{ dress_design }}';
            const size = '{{ size }}';

            // Populate dress type
            const dressTypeSelect = document.getElementById('edit-dress-type');
            dressTypeSelect.innerHTML = '<option value="">Select Dress Type</option>';
            for (const type in dressData[gender]) {
                dressTypeSelect.innerHTML += `<option value="${type}" ${type === dressType ? 'selected' : ''}>${type}</option>`;
            }
            updateDesignOptions();
            dressTypeSelect.value = dressType;

            // Populate design
            const designSelect = document.getElementById('edit-dress-design');
            designSelect.innerHTML = '<option value="">Select Dress Design</option>';
            for (const design of dressData[gender][dressType].designs) {
                designSelect.innerHTML += `<option value="${design}" ${design === dressDesign ? 'selected' : ''}>${design}</option>`;
            }

            // Populate size
            const sizeSelect = document.getElementById('edit-size');
            sizeSelect.innerHTML = '<option value="">Select Size</option>';
            for (const sizeOption in dressData[gender][dressType].sizes) {
                sizeSelect.innerHTML += `<option value="${sizeOption}" ${sizeOption === size ? 'selected' : ''}>${sizeOption}</option>`;
            }

            // Populate quantity
            const quantitySelect = document.getElementById('edit-quantity');
            quantitySelect.value = '{{ quantity }}'; // set the value based on the current quantity

            // Update the displayed total price
            updateTotalPrice();
        }

        function updateDesignOptions() {
            const gender = '{{ gender }}';
            const dressTypeSelect = document.getElementById('edit-dress-type');
            const dressDesignSelect = document.getElementById('edit-dress-design');

            const selectedType = dressTypeSelect.value;
            dressDesignSelect.innerHTML = '<option value="">Select Dress Design</option>';
            if (selectedType) {
                const designs = dressData[gender][selectedType].designs;
                for (const design of designs) {
                    dressDesignSelect.innerHTML += `<option value="${design}">${design}</option>`;
                }
            }
        }

        function updateTotalPrice() {
            const gender = '{{ gender }}';
            const dressTypeSelect = document.getElementById('edit-dress-type');
            const sizeSelect = document.getElementById('edit-size');
            const quantitySelect = document.getElementById('edit-quantity');

            const selectedType = dressTypeSelect.value;
            const selectedSize = sizeSelect.value;
            const quantity = quantitySelect.value;

            if (selectedType && selectedSize) {
                const price = dressData[gender][selectedType].sizes[selectedSize].price * quantity;
                document.querySelector('.total-price').innerHTML = `<strong>Total Price:</strong> â‚¹<span id="total-price">${price}</span>`;
                document.getElementById('hidden-dress-type').value = selectedType;
                document.getElementById('hidden-size').value = selectedSize;
                document.getElementById('hidden-quantity').value = quantity;

                // Update displayed details dynamically
                document.getElementById('dress-type-display').innerText = selectedType;
                document.getElementById('dress-design-display').innerText = document.getElementById('edit-dress-design').value || 'Not Selected';
                document.getElementById('size-display').innerText = selectedSize || 'Not Selected';
                document.getElementById('quantity-display').innerText = quantity;
            }
        }

        function saveChanges() {
            // Update displayed details without form submission
            updateTotalPrice();
            editOption(); // Hide the edit form after saving
        }

        function cancelEdit() {
            document.querySelector('.edit-form').style.display = 'none'; // Close the edit form
        }
    </script>
</body>
</html>